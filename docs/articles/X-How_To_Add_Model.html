<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adding new X models to `ramp.xds` • ramp.library</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Adding new X models to `ramp.xds`">
<meta property="og:description" content="ramp.library">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ramp.library</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Adding_Models.html">Adding Models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mosquito - Adult
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MYZ-Overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/MYZ-How_To_Add_Model.html">How to add a new MYZ model</a>
    </li>
    <li>
      <a href="../articles/MYZ-macdonald.html">Macdonald's Model</a>
    </li>
    <li>
      <a href="../articles/MYZ-xde-RMG.html">A Behavioral State Model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mosquito - Aquatic
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/L-Overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/L-How_To_Add_Model.html">How to add a new L model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Human / Host
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Malaria-Overview.html">Malaria Overview</a>
    </li>
    <li>
      <a href="../articles/Compartmental-Models.html">Compartmental Models</a>
    </li>
    <li>
      <a href="../articles/X-How_To_Add_Model.html">How to add a new X model</a>
    </li>
    <li>
      <a href="../articles/human_sip.html">SIP xde model</a>
    </li>
    <li>
      <a href="../articles/human_seis.html">SEIS model</a>
    </li>
    <li>
      <a href="../articles/X-garki.html">The Garki Model</a>
    </li>
    <li>
      <a href="../articles/X-xde-workhorse.html">Workhorse</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dd-harp/ramp.library/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Adding new X models to
<code>ramp.xds</code>
</h1>
            <h3 data-toc-skip class="subtitle">Human/Vertebrate Host
Infection Dynamics</h3>
            
      
      
      <div class="hidden name"><code>X-How_To_Add_Model.Rmd</code></div>

    </div>

    
    
<hr>
<p>This vignette discusses how to add a new model family to <a href="https://github.com/dd-harp/ramp.library" class="external-link"><code>ramp.library</code></a>
that can be used by <a href="https://github.com/dd-harp/ramp.xds" class="external-link"><code>ramp.xds</code></a>.
This vignette covers models of parasite infection dynamics and immunity
in humans or other hosts – the dynamical components we have denoted
<span class="math inline">\(\cal X\)</span> and <span class="math inline">\(\cal H.\)</span></p>
<hr>
<p>We have written this vignette to produce a new template file using
<code>knitr::purl,</code> which can be modified to build a new model.
Simply execute the following command, to create
<code>Xmod-newXname.R.</code> Then, rename <code>Xmod-newXname.R</code>
by replacing <code>newXname</code> in the filename. Then open the file
and do a global search for <code>newXname</code> and replace it with
your new name.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html" class="external-link">purl</a></span><span class="op">(</span><span class="st">"X-How_To_Add_Model.Rmd"</span>, </span>
<span>            output <span class="op">=</span> <span class="st">"Xmod-newXname.R"</span>, </span>
<span>            documentation <span class="op">=</span> <span class="fl">0</span>, </span>
<span>            quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This is a good start, but there’s more work to do. For more details,
read the text that follows.</p>
<p>This basic introduction is lacking some information that typical
users might find useful. In particular, we have defined best practices
encoding the <span class="math inline">\(\cal H\)</span> component of
models. A vignette is planned.</p>
<div class="section level2">
<h2 id="reusable-code">Reusable Code<a class="anchor" aria-label="anchor" href="#reusable-code"></a>
</h2>
<p>This package – <code>ramp.library</code> – contains reusable code
that has been rigorously tested and that implements a large number of
dynamical model families and other algorithms taken from the literature
describing malaria and other mosquito-transmitted pathogens (see Reiner,
<em>et al.</em> 2013)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. The supporting code was designed to be
modular, and plug-and-play. The modular design makes it possible to
break down published models to serve as the dynamical components in new
models for malaria. The model families in <code>ramp.library</code>
supports nimble model building that can be used by:</p>
<ul>
<li><p><a href="https://github.com/dd-harp/ramp.xds" class="external-link"><code>ramp.xds</code></a>
implements a modular, flexible, and extensible framework for building
systems of ordinary and delay differential equations models for malaria
and other mosquito-transmitted pathogens. The mathematic framework for
<code>ramp.xds</code> was explained in <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" target="_blank" class="external-link">Spatial Dynamics of Malaria Transmission</a> <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p></li>
<li><p><a href="https://github.com/dd-harp/ramp.dts" class="external-link"><code>ramp.dts</code></a>
implements a modular, flexible, and extensible framework for building
discrete time systems, including both deterministic and stochastic
difference equations for malaria and other mosquito-transmitted
pathogens.</p></li>
</ul>
<p>This vignette was written to help add new models to
<code>ramp.xds.</code></p>
<p>In planned companion to this vignette, we show how to add models of
<span class="math inline">\(\cal XH\)</span> to <a href="https://github.com/dd-harp/ramp.dts" class="external-link"><code>ramp.dts</code></a>.</p>
<hr>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<p>A new model family of class <span class="math inline">\(\cal
XH\)</span> – human infection dynamics, including immunity – has 17
required functions encoded using a standard template. Some of these
required functions are <code>S3</code> class functions in <a href="https://github.com/dd-harp/ramp.xds/blob/main/R/human-interface.R" target="_blank" class="external-link">human-interface.R</a>, and several examples are posted
in the <code>ramp.xds</code> github repository, including the
<code>SIS</code> model <a href="https://github.com/dd-harp/ramp.xds/blob/main/R/human-SIS.R" target="_blank" class="external-link">human-SIS.R</a>.</p>
<p>To configure a new model, you must choose a string called
<code>newXname</code>. The only rule for choosing <code>newXname</code>
is that it must be unique. No other <span class="math inline">\({\cal
XH}\)</span> class model in <code>ramp.xds</code> or
<code>ramp.library</code> can be using that string already. All the
<code>S3</code> functions get dispatched by the string that replaces
<code>newXname.</code></p>
<p>The 17 required functions are:</p>
<p><strong>Derivatives</strong></p>
<ol style="list-style-type: decimal">
<li>
<code>dXdt.newXname</code> - differential equations are defined by a
system of differential equations. in <code>ramp.xds</code> these are
encoded in a function called <code>dXdt</code> that computes and returns
the <strong>derivatives.</strong> The function is set up so that the
system can be solved by <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">deSolve::ode</a></code> or
<code>deSolve::dede.</code>
</li>
</ol>
<p><strong>Variables</strong> - A set of functions is set up that
document the variables by name and assign each one an index, to store,
assign and update initial values. These functions streamline setup, and
guarantee consistency.</p>
<ol start="2" style="list-style-type: decimal">
<li><p><code>create_Xinits_newXname</code> - each model requires a
function that documents the variables by name and assigns initial
values</p></li>
<li><p><code>make_Xinits.newXname</code> - is a wrapper, that gets
called by <code>ramp.xds::xde_setup.</code> It gets called by
<code>create_Xinits_newXname,</code> and for the <span class="math inline">\(i^{th}\)</span> host, the initial values are
stored as <code>pars$Xinits[[i]].</code></p></li>
<li><p><code>make_indices_X.newXname</code> - is the function that
assigns an index to each variable in the model, and stores it as
<code>pars$ix$X[[i]].</code> The indices are returned as a named
list.</p></li>
<li><p><code>list_Xvars.newXname</code> - retrieves the value of
variables at a point in time and returns the values by name in a list;
the function gets called by <code>dXdt</code> and by
<code>update_Xinits</code> and it can be useful in other
contexts.</p></li>
<li><p><code>get_inits_X.newXname</code> - retrieves the stored initial
values in the same order that they are returned by
<code>dXdt.newXname</code></p></li>
<li><p><code>update_Xinits.newXname</code> - a utility that makes it
possible to extract and store a new set of initial values for
<code>newXname</code> from a vector <span class="math inline">\(y\)</span> holding all the variables in a
model.</p></li>
</ol>
<p><strong>Parameters</strong></p>
<ol start="8" style="list-style-type: decimal">
<li>
<p><code>create_Xpar_newXname</code> returns a formatted list:</p>
<ul>
<li><p>the parameter values are stored by name</p></li>
<li><p><code>class(pars)</code> = <code>newXname</code></p></li>
</ul>
</li>
<li><p><code>make_Xpar.newXname</code> is a wrapper that calls
<code>create_Xpar_newXname</code></p></li>
</ol>
<p><strong>Dynamical Terms</strong> are Computed using a Standard Set of
Functions</p>
<ol start="10" style="list-style-type: decimal">
<li><p><code>F_X.newXname</code> - compute the effective infective
density of the vertebrate hosts</p></li>
<li><p><code>F_H.newXname</code> - compute the human population density
for the host strata</p></li>
<li><p><code>F_b.newXname</code> - compute the probability a most will
become infected after receiving an infective bite, which combines
elements of this <span class="math inline">\(\cal X\)</span> model with
a model of environmental heterogeneity in
<code>Exposure.</code></p></li>
</ol>
<p><strong>Outputs</strong></p>
<ol start="13" style="list-style-type: decimal">
<li><p><code>parse_deout_X.newXname</code> - this function parses the
output of <code>deSolve</code> and returns a named list that is either a
vector or a matrix holding the values of the variables at each point in
time. It works like <code>list_Xvars,</code> which accepts a vector
holding <span class="math inline">\(y\)</span>, the values of the
variables at a single point in time.</p></li>
<li><p><code>F_pr.newXname</code> - this function takes</p></li>
<li><p><code>HTC.newXname</code></p></li>
</ol>
<p><strong>Outputs</strong></p>
<ol start="16" style="list-style-type: decimal">
<li><p><code>xds_lines_X.newXname</code></p></li>
<li><p><code>xds_plot_X.newXname</code> is a wrapper that calls
<code>xds_lines_X</code></p></li>
</ol>
</div>
<div class="section level3">
<h3 id="style">Style<a class="anchor" aria-label="anchor" href="#style"></a>
</h3>
<p>We recommend that new models conform to a set of style
guidelines:</p>
<ul>
<li><p>All the names of the variables by name using the indices attached
to <code>Xpar</code></p></li>
<li><p>All documentation is written in <code>roxygen2</code></p></li>
<li><p>Functions should use <code>with(*,{...})</code> to make the code
easier to read.</p></li>
<li><p>A vignette should accompany each model, including citations to
the relevant publications, and proposed tests of the code.</p></li>
<li><p>The functions should easy to relate to the equations defining a
model, following notation defined in an accompanying vignette.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="derivatives">Derivatives<a class="anchor" aria-label="anchor" href="#derivatives"></a>
</h2>
<div class="section level3">
<h3 id="dxdt">1. dXdt<a class="anchor" aria-label="anchor" href="#dxdt"></a>
</h3>
<p>The function <code>dXdt</code> is established as a generic function
that dispatches on <code>Xpar.</code> Since there might be many host
species, it actually dispatches on the <span class="math inline">\(i^{th}\)</span> element in a list,
<code>pars$Xpar[[i]].</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Derivatives for human population</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param t current simulation time</span></span>
<span><span class="co">#' @param y state vector</span></span>
<span><span class="co">#' @param pars a list</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return a [numeric] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">dXdt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"dXdt"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dxdt-sis">dXdt.SIS<a class="anchor" aria-label="anchor" href="#dxdt-sis"></a>
</h3>
<p>This is a version of the <code>SIS</code> model in
<code>ramp.xds</code> with demographics. If a model has any demographic
processes (<em>e.g.</em> aging, migration, births and deaths), then each
variable’s derivative must be transformed by the same matrix as the
human population density, <code>H</code>. Any disease induced mortality
should be included in a matrix that computes changes in human population
density, <code>dHdt</code>.</p>
<p>In the following, we use the <code><a href="https://rdrr.io/r/base/with.html" class="external-link">with()</a></code> function to expose
parameter names attached to lists to make the code easy to read.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Derivatives for human population</span></span>
<span><span class="co">#' @description Implements [dXdt] for the SIS model, no demography.</span></span>
<span><span class="co">#' @inheritParams dXdt</span></span>
<span><span class="co">#' @return a [numeric] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">dXdt.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">foi</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">FoI</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/list_Xvars.html" class="external-link">list_Xvars</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/F_H.html" class="external-link">F_H</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="op">{</span></span>
<span>      <span class="va">dS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/Births.html" class="external-link">Births</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">H</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">-</span> <span class="va">foi</span><span class="op">*</span><span class="va">S</span> <span class="op">+</span> <span class="va">r</span><span class="op">*</span><span class="va">I</span> <span class="op">+</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/dHdt.html" class="external-link">dHdt</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">S</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span></span>
<span>      <span class="va">dI</span> <span class="op">&lt;-</span> <span class="va">foi</span><span class="op">*</span><span class="va">S</span> <span class="op">-</span> <span class="va">r</span><span class="op">*</span><span class="va">I</span> <span class="op">+</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/dHdt.html" class="external-link">dHdt</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">I</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dS</span>, <span class="va">dI</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dxdt-newxname">dXdt.newXname<a class="anchor" aria-label="anchor" href="#dxdt-newxname"></a>
</h3>
<p>This <em>should</em> be straightforward, but there’s one very
important wrinkle. If you want to be able to use the
<code>ramp.xds</code> capabilities for cohort dynamics and vital
dynamics, then the dynamics must be extended carefully to call the
demographic matrix function <code>dHdt.</code> This can become tricky,
so we handle it elsewhere. When writing the code:</p>
<ul>
<li><p>The foi gets computed in <code>Exposure</code> and stored as
<code>pars$FoI[[i]]</code> for the <span class="math inline">\(i^{th}\)</span> host species.</p></li>
<li><p>In the next step, the variables are extracted from the variable
vector, <code>y</code>, using the indices, which are stored in
<code>pars$ix$X[[i]]</code></p></li>
<li><p>We compute the derivatives.</p></li>
<li>
<p>We return the variables in order. Be sure to establish and then
maintain a convention for ordering the variables in your model, and then
maintain that order in every function. In particular:</p>
<ul>
<li><p>set up the initial values in that order</p></li>
<li><p>return the derivatives in that order</p></li>
</ul>
</li>
<li><p>Be careful about how you nest the <code>with(*, ...)</code>
calls.</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Compute the derivatives for parasite infection dynamics in human population strata </span></span>
<span><span class="co">#' @description Implements [dXdt] for the newXname model</span></span>
<span><span class="co">#' @inheritParams ramp.xds::dXdt</span></span>
<span><span class="co">#' @return a [numeric] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">dXdt.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># do not change this</span></span>
<span>  <span class="va">foi</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">FoI</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># attach the variables by name </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/list_Xvars.html" class="external-link">list_Xvars</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="co"># compute H (if it isn't one of the variables) </span></span>
<span>    <span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/F_H.html" class="external-link">F_H</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># expose the parameters (see create_Xpar_Xname) </span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="op">{</span></span>
<span>      <span class="co"># compute the derivatives </span></span>
<span>      <span class="va">dX1</span> <span class="op">&lt;-</span> <span class="va">...</span> </span>
<span>      <span class="va">dX2</span> <span class="op">&lt;-</span> <span class="va">...</span></span>
<span>      <span class="va">...</span> </span>
<span>      </span>
<span>      <span class="co"># concatenate the derivatives </span></span>
<span>      <span class="va">derivs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dX1</span>, <span class="va">dX2</span>, <span class="va">...</span><span class="op">)</span> </span>
<span>      </span>
<span>      <span class="co"># return the derivatives </span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">derivs</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="variables">Variables<a class="anchor" aria-label="anchor" href="#variables"></a>
</h2>
<div class="section level3">
<h3 id="create_xinits">2. create_Xinits<a class="anchor" aria-label="anchor" href="#create_xinits"></a>
</h3>
<div class="section level4">
<h4 id="create_xinits_sis">create_Xinits_SIS<a class="anchor" aria-label="anchor" href="#create_xinits_sis"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Make initial values for the SIS human model, with defaults</span></span>
<span><span class="co">#' @param nStrata the number of strata in the model</span></span>
<span><span class="co">#' @param Xopts a [list] to overwrite defaults</span></span>
<span><span class="co">#' @param H0 the initial human population density</span></span>
<span><span class="co">#' @param S0 the initial values of the parameter S</span></span>
<span><span class="co">#' @param I0 the initial values of the parameter I</span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">create_Xinits_SIS</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">nStrata</span>, <span class="va">Xopts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">H0</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">S0</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">I0</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Xopts</span>,<span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">S0</span><span class="op">)</span><span class="op">)</span> <span class="va">S0</span> <span class="op">=</span> <span class="va">H0</span> <span class="op">-</span> <span class="va">I0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">S0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">S0</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>  <span class="va">I</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">I0</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S<span class="op">=</span><span class="va">S</span>, I<span class="op">=</span><span class="va">I</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create_xinits_newxname">create_Xinits_newXname<a class="anchor" aria-label="anchor" href="#create_xinits_newxname"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Make initial values for the Xname human model, with defaults</span></span>
<span><span class="co">#' @param nStrata the number of strata in the model</span></span>
<span><span class="co">#' @param Xopts a [list] to overwrite defaults</span></span>
<span><span class="co">#' @param X10 the initial value for X1 </span></span>
<span><span class="co">#' @param X20 the initial value for X1 </span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">create_Xinits_newXname</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">nStrata</span>, <span class="va">Xopts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">X10</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">X20</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Xopts</span>,<span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">X10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">X20</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">X1</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">X10</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>  <span class="va">X2</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">X20</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1<span class="op">=</span><span class="va">X1</span>, X2<span class="op">=</span><span class="va">X2</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="make_xinits">3. make_Xinits<a class="anchor" aria-label="anchor" href="#make_xinits"></a>
</h3>
<p>In the <code>xde_setup</code> family of setup functions, initial
values for a model fulfilling the dynamical component <span class="math inline">\(\cal X,\)</span> called <code>newXname</code> is
set up by the function <code>make_Xinits.</code></p>
<div class="section level4">
<h4 id="generic">Generic<a class="anchor" aria-label="anchor" href="#generic"></a>
</h4>
<p>The <code>make_Xinits</code> function dispatches on
<code>pars$Xpar[[i]]</code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title A function to set up Xpar</span></span>
<span><span class="co">#' @description This method dispatches on `newXname`.</span></span>
<span><span class="co">#' @param pars a [list]</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @param Xopts a [list]</span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_Xinits</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span>, <span class="va">Xopts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"make_Xinits"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="make_xinits-sis">make_Xinits.SIS<a class="anchor" aria-label="anchor" href="#make_xinits-sis"></a>
</h4>
<p>The <code>make_Xinits.SIS</code> calls
<code>create_Xinits_SIS</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Setup Xinits.SIS</span></span>
<span><span class="co">#' @description Implements [make_Xinits] for the SIS model</span></span>
<span><span class="co">#' @inheritParams make_Xinits</span></span>
<span><span class="co">#' @return a [list] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_Xinits.SIS</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span>, <span class="va">Xopts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pars</span><span class="op">$</span><span class="va">Xinits</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>, <span class="fu">create_Xinits_SIS</span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span>, <span class="va">Xopts</span>, H0<span class="op">=</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">H</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="make_xinits-newxname">make_Xinits.newXname<a class="anchor" aria-label="anchor" href="#make_xinits-newxname"></a>
</h4>
<p>To modify, replace <code>newXname</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Setup Xinits.newXname</span></span>
<span><span class="co">#' @description Implements [make_Xinits] for the newXname model</span></span>
<span><span class="co">#' @inheritParams ramp.xds::make_Xinits</span></span>
<span><span class="co">#' @return a [list] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_Xinits.newXname</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span>, <span class="va">Xopts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pars</span><span class="op">$</span><span class="va">Xinits</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>, <span class="fu">create_Xinits_newXname</span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span>, <span class="va">Xopts</span>, H0<span class="op">=</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">H</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="make_indices_x">4. make_indices_X<a class="anchor" aria-label="anchor" href="#make_indices_x"></a>
</h3>
<div class="section level4">
<h4 id="generic-1">Generic<a class="anchor" aria-label="anchor" href="#generic-1"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Add indices for human population to parameter list</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param pars a [list]</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_indices_X</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"make_indices_X"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="make_indices_x-sis">make_indices_X.SIS<a class="anchor" aria-label="anchor" href="#make_indices_x-sis"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Add indices for human population to parameter list</span></span>
<span><span class="co">#' @description Implements [make_indices_X] for the SIS model.</span></span>
<span><span class="co">#' @inheritParams ramp.xds::make_indices_X</span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @importFrom utils tail</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_indices_X.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>,<span class="op">{</span></span>
<span></span>
<span>  <span class="va">S_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">max_ix</span><span class="op">+</span><span class="fl">1</span>, length.out<span class="op">=</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span></span>
<span>  <span class="va">max_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">S_ix</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">I_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">max_ix</span><span class="op">+</span><span class="fl">1</span>, length.out<span class="op">=</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span></span>
<span>  <span class="va">max_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">I_ix</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">pars</span><span class="op">$</span><span class="va">max_ix</span> <span class="op">=</span> <span class="va">max_ix</span></span>
<span>  <span class="va">pars</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S_ix<span class="op">=</span><span class="va">S_ix</span>, I_ix<span class="op">=</span><span class="va">I_ix</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="make_indices_x-newxname">make_indices_X.newXname<a class="anchor" aria-label="anchor" href="#make_indices_x-newxname"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Add indices for human population to parameter list</span></span>
<span><span class="co">#' @description Implements [make_indices_X] for the newXname model.</span></span>
<span><span class="co">#' @inheritParams make_indices_X</span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @importFrom utils tail</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_indices_X.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>,<span class="op">{</span></span>
<span></span>
<span>  <span class="va">X1_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">max_ix</span><span class="op">+</span><span class="fl">1</span>, length.out<span class="op">=</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span></span>
<span>  <span class="va">max_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">X1_ix</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">X2_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">max_ix</span><span class="op">+</span><span class="fl">1</span>, length.out<span class="op">=</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span></span>
<span>  <span class="va">max_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">X2_ix</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">...</span> </span>
<span>  </span>
<span>  <span class="va">pars</span><span class="op">$</span><span class="va">max_ix</span> <span class="op">=</span> <span class="va">max_ix</span></span>
<span>  <span class="va">pars</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1_ix<span class="op">=</span><span class="va">X1_ix</span>, X2_ix<span class="op">=</span><span class="va">X2_ix</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="list_xvars">5. list_Xvars<a class="anchor" aria-label="anchor" href="#list_xvars"></a>
</h3>
<div class="section level4">
<h4 id="generic-2">Generic<a class="anchor" aria-label="anchor" href="#generic-2"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Return the variables as a list</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param y the variables</span></span>
<span><span class="co">#' @param pars a [list]</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">list_Xvars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"list_Xvars"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="list_xvars-sis">list_Xvars.SIS<a class="anchor" aria-label="anchor" href="#list_xvars-sis"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Return the variables as a list</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`</span></span>
<span><span class="co">#' @inheritParams list_Xvars</span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">list_Xvars.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="op">{</span></span>
<span>      <span class="va">S</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">S_ix</span><span class="op">]</span></span>
<span>      <span class="va">I</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">I_ix</span><span class="op">]</span></span>
<span>      <span class="va">H</span> <span class="op">=</span> <span class="va">S</span><span class="op">+</span><span class="va">I</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S<span class="op">=</span><span class="va">S</span>,I<span class="op">=</span><span class="va">I</span>,H<span class="op">=</span><span class="va">H</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="list_xvars-newxname">list_Xvars.newXname<a class="anchor" aria-label="anchor" href="#list_xvars-newxname"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Return the variables as a list</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`</span></span>
<span><span class="co">#' @inheritParams ramp.xds::list_Xvars</span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">list_Xvars.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="op">{</span></span>
<span>      <span class="va">X1</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">X1_ix</span><span class="op">]</span></span>
<span>      <span class="va">X2</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">X2_ix</span><span class="op">]</span></span>
<span>      <span class="va">...</span></span>
<span>      <span class="va">H</span> <span class="op">=</span> <span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="va">...</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1<span class="op">=</span><span class="va">X1</span>,X2<span class="op">=</span><span class="va">X2</span>,<span class="va">...</span>,H<span class="op">=</span><span class="va">H</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="get_inits_x">6. get_inits_X<a class="anchor" aria-label="anchor" href="#get_inits_x"></a>
</h3>
<p>By now the pattern should be obvious.</p>
<div class="section level4">
<h4 id="generic-3">Generic<a class="anchor" aria-label="anchor" href="#generic-3"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Return initial values as a vector</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param pars a [list]</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">get_inits_X</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"get_inits_X"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="get_inits_x-sis">get_inits_X.SIS<a class="anchor" aria-label="anchor" href="#get_inits_x-sis"></a>
</h4>
<p>Returns the initial values, in order, by name.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Return initial values as a vector</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @inheritParams get_inits_X</span></span>
<span><span class="co">#' @return a [numeric] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">get_inits_X.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xinits</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">S</span>,<span class="va">I</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="get_inits_x-newxname">get_inits_X.newXname<a class="anchor" aria-label="anchor" href="#get_inits_x-newxname"></a>
</h4>
<p>Write the function to return the initial values, in order, by
name.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Return initial values as a vector</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @inheritParams ramp.xds::get_inits_X</span></span>
<span><span class="co">#' @return a [numeric] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">get_inits_X.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xinits</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">X1</span>,<span class="va">X2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="update_xinits">7. update_Xinits<a class="anchor" aria-label="anchor" href="#update_xinits"></a>
</h3>
<p>Pass a vector <code>y</code>, extract the values of the variables,
and modify the initial values.</p>
<div class="section level4">
<h4 id="generic-4">Generic<a class="anchor" aria-label="anchor" href="#generic-4"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Set the initial values from a vector of states</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param pars a [list]</span></span>
<span><span class="co">#' @param y0 a vector of initial values</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">update_Xinits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">y0</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"update_Xinits"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="update_xinits-sis">update_Xinits.SIS<a class="anchor" aria-label="anchor" href="#update_xinits-sis"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Update inits for the SIS human model from a vector of states</span></span>
<span><span class="co">#' @inheritParams update_Xinits</span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">update_Xinits.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">y0</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/list_Xvars.html" class="external-link">list_Xvars</a></span><span class="op">(</span><span class="va">y0</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="va">pars</span><span class="op">$</span><span class="va">Xinits</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">create_Xinits_SIS</span><span class="op">(</span><span class="va">pars</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, S0<span class="op">=</span><span class="va">S</span>, I0<span class="op">=</span><span class="va">I</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="update_xinits-newxname">update_Xinits.newXname<a class="anchor" aria-label="anchor" href="#update_xinits-newxname"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Update inits for the newXname human model from a vector of states</span></span>
<span><span class="co">#' @inheritParams ramp.xds::update_Xinits </span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">update_Xinits.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">y0</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/list_Xvars.html" class="external-link">list_Xvars</a></span><span class="op">(</span><span class="va">y0</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="va">pars</span> <span class="op">=</span> <span class="fu">create_Xinits_newXname</span><span class="op">(</span><span class="va">pars</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, X10<span class="op">=</span><span class="va">X1</span>, X20<span class="op">=</span><span class="va">X2</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<p>The second function sets up a list <code>Xpar</code> that dispatches
<code>dXdt</code> and that has the parameter values.</p>
<div class="section level3">
<h3 id="create_xpar_sis">8. create_Xpar_SIS<a class="anchor" aria-label="anchor" href="#create_xpar_sis"></a>
</h3>
<p>There is no <code>S3</code> definition for the
<code>create_Xpar_*</code> class of functions. Instead, we write a
generic <code>S3</code> function called <code>make_Xpar</code> that
calls a function <code>make_Xpar_*</code> There is, nevertheless, a
reasonably standard formula for <code>make_Xpar_*</code></p>
<ul>
<li><p>The first argument is <code>nStrata</code> the number of
population strata for the species.</p></li>
<li><p>The first argument is <code>Xopts().</code> Notice that
<code>Xopts()</code> is an empty list by default, but if a non-empty
list is passed, the values overwrite the defaults.</p></li>
<li><p>The parameters are attached by name. These parameter names must
be the same ones used in <code>dXdt</code></p></li>
<li><p>By default, they should have
<code>length(*)= nStrata</code></p></li>
<li><p>The last part of the function name is the string that dispatches
the <code>S3</code> functions. In <code>create_Xpar_SIS,</code> we write
<code>class(Xpar) &lt;- "SIS"</code></p></li>
</ul>
<div class="section level4">
<h4 id="create_xpar_sis-1">create_Xpar_SIS<a class="anchor" aria-label="anchor" href="#create_xpar_sis-1"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Make parameters for SIS human model, with defaults</span></span>
<span><span class="co">#' @param nStrata is the number of population strata</span></span>
<span><span class="co">#' @param Xopts a [list] that could overwrite defaults</span></span>
<span><span class="co">#' @param b transmission probability (efficiency) from mosquito to human</span></span>
<span><span class="co">#' @param c transmission probability (efficiency) from human to mosquito</span></span>
<span><span class="co">#' @param r recovery rate</span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">create_Xpar_SIS</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">nStrata</span>, <span class="va">Xopts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                         <span class="va">b</span><span class="op">=</span><span class="fl">0.55</span>, <span class="va">r</span><span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">180</span>, <span class="va">c</span><span class="op">=</span><span class="fl">0.15</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Xopts</span>,<span class="op">{</span></span>
<span>    <span class="va">Xpar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">Xpar</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"SIS"</span></span>
<span></span>
<span>    <span class="va">Xpar</span><span class="op">$</span><span class="va">b</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>    <span class="va">Xpar</span><span class="op">$</span><span class="va">c</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>    <span class="va">Xpar</span><span class="op">$</span><span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Xpar</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create_xpar_newxname">create_Xpar_newXname<a class="anchor" aria-label="anchor" href="#create_xpar_newxname"></a>
</h4>
<p>To format this for a new function, do a search and replace on
<code>newXname</code> and replace the parmeter names and values <span class="math inline">\(p1\)</span>, <span class="math inline">\(p2\)</span>, <span class="math inline">\(\ldots\)</span></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Make parameters for newXname human model, with defaults</span></span>
<span><span class="co">#' @param nStrata is the number of population strata</span></span>
<span><span class="co">#' @param Xopts a [list] that could overwrite defaults</span></span>
<span><span class="co">#' @param p1 the first parameter </span></span>
<span><span class="co">#' @param p2 the second parameter </span></span>
<span><span class="co">#' @param p3 the third parameter </span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">create_Xpar_newXname</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">nStrata</span>, <span class="va">Xopts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                         <span class="va">p1</span><span class="op">=</span><span class="fl">1</span>, <span class="va">p2</span><span class="op">=</span><span class="fl">2</span>, <span class="va">p3</span><span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Xopts</span>,<span class="op">{</span></span>
<span>    <span class="va">Xpar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">Xpar</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"newXname"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">Xpar</span><span class="op">$</span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>    <span class="va">Xpar</span><span class="op">$</span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>    <span class="va">Xpar</span><span class="op">$</span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/checkIt.html" class="external-link">checkIt</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Xpar</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="make_xpar">9. make_Xpar<a class="anchor" aria-label="anchor" href="#make_xpar"></a>
</h3>
<p>In the <code>xde_setup</code> family of setup functions, setup for a
model fulfilling the dynamical component <span class="math inline">\(\cal X,\)</span> called <code>newXname</code> is
set up by the function <code>make_Xpar.</code></p>
<div class="section level4">
<h4 id="generic-5">Generic<a class="anchor" aria-label="anchor" href="#generic-5"></a>
</h4>
<p>This function must set up <code>Xpar</code> and it must also set up
the initial values. By convention, the functions that get called are not
<code>S3</code> class functions.</p>
<p>The <code>make_Xpar</code> functions assigns to <code>Xname</code>
the <code>class(Xname)</code> and dispatches on <code>Xname</code></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title A function to set up Xpar</span></span>
<span><span class="co">#' @description This method dispatches on `Xname`.</span></span>
<span><span class="co">#' @param Xname a [character] string</span></span>
<span><span class="co">#' @param pars a [list]</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @param Xopts a [list]</span></span>
<span><span class="co">#' @return a [list]</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_Xpar</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Xname</span>, <span class="va">pars</span>, <span class="va">i</span>, <span class="va">Xopts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">Xname</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Xname</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"make_Xpar"</span>, <span class="va">Xname</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="make_xpar-sis">make_Xpar.SIS<a class="anchor" aria-label="anchor" href="#make_xpar-sis"></a>
</h4>
<p>The dispatched function <code>SIS</code> ignores xname, but it calls
a function <code>create_Xpar_SIS</code></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Setup Xpar.SIS</span></span>
<span><span class="co">#' @description Implements [make_Xpar] for the SIS model</span></span>
<span><span class="co">#' @inheritParams make_Xpar</span></span>
<span><span class="co">#' @return a [list] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_Xpar.SIS</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Xname</span>, <span class="va">pars</span>, <span class="va">i</span>, <span class="va">Xopts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">create_Xpar_SIS</span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span>, <span class="va">Xopts</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="make_xpar-newxname">make_Xpar.newXname<a class="anchor" aria-label="anchor" href="#make_xpar-newxname"></a>
</h4>
<p>To use this, simply to a search and replace on
<code>newXname.</code></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Setup Xpar.newXname</span></span>
<span><span class="co">#' @description Implements [make_Xpar] for the newXname model</span></span>
<span><span class="co">#' @inheritParams ramp.xds::make_Xpar</span></span>
<span><span class="co">#' @return a [list] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">make_Xpar.newXname</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">newXname</span>, <span class="va">pars</span>, <span class="va">i</span>, <span class="va">Xopts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">create_Xpar_newXname</span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span>, <span class="va">Xopts</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="terms">Terms<a class="anchor" aria-label="anchor" href="#terms"></a>
</h2>
<p>All models in <code>ramp.xds</code> the modular design dictates that
we must define a few functions that compute a few key quantities:</p>
<ul>
<li><p><code>X</code> is defined to be the effective density of
infectious humans, retrieved by <code>F_X</code></p></li>
<li><p><code>H</code> is defined to be the size of each population
stratum, retrieved by <code>F_H</code></p></li>
<li><p><code>b</code> is defined to be the fraction of infective bites
that cause an infection, retrieved by <code>F_b</code></p></li>
</ul>
<div class="section level3">
<h3 id="f_x">10. F_X<a class="anchor" aria-label="anchor" href="#f_x"></a>
</h3>
<p>The function <code>F_X</code> returns the effective density of
infectious humans for each stratum. The notion is that <span class="math inline">\(X\)</span> is proportional to <span class="math inline">\(H\)</span>, where the constant is the fraction of
bites on the strata that would infect a mosquito.</p>
<div class="section level4">
<h4 id="generic-6">Generic<a class="anchor" aria-label="anchor" href="#generic-6"></a>
</h4>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Size of effective infectious human population</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param y state vector</span></span>
<span><span class="co">#' @param pars a list</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_X</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"F_X"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="f_x-sis">F_X.SIS<a class="anchor" aria-label="anchor" href="#f_x-sis"></a>
</h4>
<p>As an example, we include the <span class="math inline">\(SIS\)</span> model from <code>ramp.xds.</code> In
the <code>SIS</code> model, the returned value is <span class="math inline">\(cI\)</span> where <span class="math inline">\(I\)</span> is the density of infected individuals;
the prevalence of infection is <span class="math inline">\(X/H\)</span>.
The constant <span class="math inline">\(c\)</span> is the probability a
mosquito would become infected after blood feeding on an infected human.
Two things to note:</p>
<ul>
<li>First, <code>ramp.xds</code> holds the indices by component under
<code>pars$ix,</code> so <code>pars$ix$X</code> holds the indices for
all the variables for all species, and <code>pars$ix$X[[i]]</code> holds
the indices for the <span class="math inline">\(i^{th}\)</span> species.
Putting them under <code>X</code> helps to avoid conflicts if, for
example, another dynamical component happened to use the same variable
name.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Size of effective infectious human population</span></span>
<span><span class="co">#' @description Implements [F_X] for the SIS model.</span></span>
<span><span class="co">#' @inheritParams F_X</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_X.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">I</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">I_ix</span><span class="op">]</span></span>
<span>  <span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">c</span><span class="op">*</span><span class="va">I</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The commented code relevant code that must be changed is commented
out. The preferred style is to <em>extract</em> the relevant variables
by name, then <em>compute</em> the effective infectious density,or
individuals in this stratum, then return the value. In the
manuscript<span class="math inline">\(^1\)</span>, this quantity was
called <strong>X.</strong></p>
</div>
<div class="section level4">
<h4 id="f_x-newxname">F_X.newXname<a class="anchor" aria-label="anchor" href="#f_x-newxname"></a>
</h4>
<p>The following is a template for new model. The declaration of
<code>inheritParams</code> from the <code>SIS</code> model in
<code>ramp.xds</code> works naturally. The namespace from
<code>ramp.xds</code> is needed, so our newXname function (above) has
<code>ramp.xds::F_X.</code></p>
<p>The steps are to extract the variables in</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Size of effective infectious human population</span></span>
<span><span class="co">#' @description Implements [F_X] for the SIS model.</span></span>
<span><span class="co">#' @inheritParams ramp.xds::F_X</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_X.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">########################</span></span>
<span>  <span class="co"># extract: </span></span>
<span>  <span class="co"># VAR &lt;- y[pars$ix$X$...] </span></span>
<span>  <span class="co">########################</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, </span>
<span>       <span class="co">########################</span></span>
<span>       <span class="co"># compute: </span></span>
<span>       <span class="co"># X &lt;- ... F(VAR) </span></span>
<span>       <span class="co">########################</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="f_h">11. F_H<a class="anchor" aria-label="anchor" href="#f_h"></a>
</h3>
<p>The total population size, <span class="math inline">\(H\)</span>, is
often important, so we write a function that computes it.</p>
<div class="section level4">
<h4 id="generic-7">Generic<a class="anchor" aria-label="anchor" href="#generic-7"></a>
</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param y state vector</span></span>
<span><span class="co">#' @param pars a list</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_H</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"F_H"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="f_h-sis">F_H.SIS<a class="anchor" aria-label="anchor" href="#f_h-sis"></a>
</h4>
<p>This is the function that computes <span class="math inline">\(H =
S+I\)</span> for the <code>SIS</code> model.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Size of effective infectious human population</span></span>
<span><span class="co">#' @description Implements [F_H] for the SIS model.</span></span>
<span><span class="co">#' @inheritParams F_H</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_H.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/list_Xvars.html" class="external-link">list_Xvars</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="f_h-newxname">F_H.newXname<a class="anchor" aria-label="anchor" href="#f_h-newxname"></a>
</h4>
<p>The function <code>F_X</code> returns the effective density of
infectious humans for each stratum. The following is a template for a
model, assuming <span class="math inline">\(H\)</span> is computed in
<code>list_Xvars</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Size of effective infectious human population</span></span>
<span><span class="co">#' @description Implements [F_H] for the newXname model.</span></span>
<span><span class="co">#' @inheritParams ramp.xds::F_H</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_H.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/list_Xvars.html" class="external-link">list_Xvars</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="f_b">12. F_b<a class="anchor" aria-label="anchor" href="#f_b"></a>
</h3>
<p>We use the short parameter name <code>b</code> to denote the fraction
of infective bites by mosquitoes that cause an infection. This is
computed in another function, called <code>Exposure</code> under a model
for environmental heterogeneity that computes a local FoI based on the
local daily EIR. Then, the total FoI is computed from a travel
model.</p>
<div class="section level4">
<h4 id="generic-8">Generic<a class="anchor" aria-label="anchor" href="#generic-8"></a>
</h4>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Infection blocking pre-erythrocytic immunity</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param y state vector</span></span>
<span><span class="co">#' @param pars a list</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_b</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"F_b"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="f_b-sis">
<code>F_b.SIS</code><a class="anchor" aria-label="anchor" href="#f_b-sis"></a>
</h4>
<p>In <code>ramp.xds,</code> we recognize the problem of translating the
local EIR into the FoI. The local EIR is computed as one of the core
model terms for each one of the model strata.</p>
<p>The function <code>F_b</code> returns the model-defined probability
an infective bite by a mosquito would cause an infection. This could
include the combined effects of inefficient transmission,
pre-erytrocytic immunity, and perhaps some effects of blood stage
immunity. In a model with no effect, the return value would be <span class="math inline">\(1\)</span>.</p>
<p>Once again, we provide the <code>SIS</code> model from
<code>ramp.xds</code> as our example:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Infection blocking pre-erythrocytic immunity</span></span>
<span><span class="co">#' @description Implements [F_b] for the SIS model.</span></span>
<span><span class="co">#' @inheritParams F_b</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_b.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="f_b-newxname">F_b.newXname<a class="anchor" aria-label="anchor" href="#f_b-newxname"></a>
</h4>
<p>Depending on the model, the value of <code>b</code> is either
retrieved or it is computed from other variables in the model, and it is
expected that <code>length(b) = nStrata</code></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Infection blocking pre-erythrocytic immunity</span></span>
<span><span class="co">#' @description Implements [F_b] for the newXname model.</span></span>
<span><span class="co">#' @inheritParams ramp.xds::F_b</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_b.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="op">{</span> </span>
<span>    <span class="co">########################</span></span>
<span>    <span class="co"># retrieve or compute it </span></span>
<span>    <span class="co">########################</span></span>
<span>    <span class="va">b</span> <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">b</span></span>
<span>    <span class="co">########################</span></span>
<span>    <span class="co"># return it </span></span>
<span>    <span class="co">########################</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="outputs">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a>
</h2>
<p>To make <code>ramp.xds</code> easy to use, we provide some functions
that parse the outputs and compute some standard metrics.</p>
<div class="section level3">
<h3 id="parse_deout_x">13. <code>parse_deout_X</code><a class="anchor" aria-label="anchor" href="#parse_deout_x"></a>
</h3>
<p><code>parse_deout_X</code> takes the output of <code>deSolve,</code>
parses the outputs using the variable indices, and returns the variables
by name as a list.</p>
<div class="section level4">
<h4 id="generic-9">Generic<a class="anchor" aria-label="anchor" href="#generic-9"></a>
</h4>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Parse the output of deSolve and return the variables by name in a list</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`. Adds the variables</span></span>
<span><span class="co">#' from the X model to a list and returns it</span></span>
<span><span class="co">#' @param deout a [matrix] of outputs from deSolve</span></span>
<span><span class="co">#' @param pars a [list] that defines a model</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">parse_deout_X</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">deout</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"parse_deout_X"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parse_deout_x-sis">parse_deout_X.SIS<a class="anchor" aria-label="anchor" href="#parse_deout_x-sis"></a>
</h4>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Parse the output of deSolve and return variables for the SIS model</span></span>
<span><span class="co">#' @description Implements [parse_deout_X] for the SIS model</span></span>
<span><span class="co">#' @inheritParams parse_deout_X</span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">parse_deout_X.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">deout</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time</span> <span class="op">=</span> <span class="va">deout</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="op">{</span></span>
<span>    <span class="va">S</span> <span class="op">=</span> <span class="va">deout</span><span class="op">[</span>,<span class="va">S_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">I</span> <span class="op">=</span> <span class="va">deout</span><span class="op">[</span>,<span class="va">I_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">H</span> <span class="op">=</span> <span class="va">S</span><span class="op">+</span><span class="va">I</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time<span class="op">=</span><span class="va">time</span>, S<span class="op">=</span><span class="va">S</span>, I<span class="op">=</span><span class="va">I</span>, H<span class="op">=</span><span class="va">H</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parse_deout_x-newxname">parse_deout_X.newXname<a class="anchor" aria-label="anchor" href="#parse_deout_x-newxname"></a>
</h4>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Parse the output of deSolve and return variables for the newXname model</span></span>
<span><span class="co">#' @description Implements [parse_deout_X] for the newXname model</span></span>
<span><span class="co">#' @inheritParams ramp.xds::parse_deout_X</span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">parse_deout_X.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">deout</span>, <span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time</span> <span class="op">=</span> <span class="va">deout</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="op">{</span></span>
<span>    <span class="va">X1</span> <span class="op">=</span> <span class="va">deout</span><span class="op">[</span>,<span class="va">X1_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">X2</span> <span class="op">=</span> <span class="va">deout</span><span class="op">[</span>,<span class="va">X2_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">...</span> </span>
<span>    <span class="va">H</span> <span class="op">=</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">...</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time<span class="op">=</span><span class="va">time</span>, X1<span class="op">=</span><span class="va">X1</span>, X2<span class="op">=</span><span class="va">X2</span>, <span class="va">...</span>, H<span class="op">=</span><span class="va">H</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="f_pr">14. F_pr<a class="anchor" aria-label="anchor" href="#f_pr"></a>
</h3>
<p>We require each model to compute the true PR.</p>
<div class="section level4">
<h4 id="generic-10">Generic<a class="anchor" aria-label="anchor" href="#generic-10"></a>
</h4>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Compute the *true* prevalence of infection / parasite rate</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar[[i]]`.</span></span>
<span><span class="co">#' @param vars a list with the variables attached by name</span></span>
<span><span class="co">#' @param Xpar a list defining a model for human</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_pr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vars</span>, <span class="va">Xpar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"F_pr"</span>, <span class="va">Xpar</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="f_pr-sis">F_pr.SIS<a class="anchor" aria-label="anchor" href="#f_pr-sis"></a>
</h4>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Compute the "true" prevalence of infection / parasite rate</span></span>
<span><span class="co">#' @description Implements F_pr for the SIS model.</span></span>
<span><span class="co">#' @inheritParams F_pr</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_pr.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vars</span>, <span class="va">Xpar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">vars</span>, <span class="va">I</span><span class="op">/</span><span class="va">H</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pr</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function <code>F_pr</code> computes the models <em>true</em>
prevalence using the variable names. It is passed the
<code>varslist</code> that is created by <code>parse_deout</code> (see
above).</p>
</div>
<div class="section level4">
<h4 id="f_pr-newxname">F_pr.newXname<a class="anchor" aria-label="anchor" href="#f_pr-newxname"></a>
</h4>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Compute the true prevalence of infection / parasite rate</span></span>
<span><span class="co">#' @description Implements F_pr for the newXname model.</span></span>
<span><span class="co">#' @inheritParams F_pr</span></span>
<span><span class="co">#' @return a [numeric] vector of length `nStrata`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">F_pr.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vars</span>, <span class="va">Xpar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">vars</span>, <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Xpar</span>,<span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">X1</span><span class="op">/</span><span class="va">H</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pr</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="htc">15. HTC<a class="anchor" aria-label="anchor" href="#htc"></a>
</h3>
<p>Similarly, we require each function to return the human transmitting
capacity, or <code>HTC</code></p>
<div class="section level4">
<h4 id="generic-11">Generic<a class="anchor" aria-label="anchor" href="#generic-11"></a>
</h4>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Compute the human transmitting capacity</span></span>
<span><span class="co">#' @description This method dispatches on the type of `pars$Xpar`.</span></span>
<span><span class="co">#' @param pars a [list]</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @return none</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">HTC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"get_inits_X"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="htc-sis">HTC.SIS<a class="anchor" aria-label="anchor" href="#htc-sis"></a>
</h4>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Compute the HTC for the SIS model</span></span>
<span><span class="co">#' @description Implements [HTC] for the SIS model with demography.</span></span>
<span><span class="co">#' @inheritParams ramp.xds::HTC</span></span>
<span><span class="co">#' @return a [numeric] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">HTC.SIS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">c</span><span class="op">/</span><span class="va">r</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="htc-newxname">HTC.newXname<a class="anchor" aria-label="anchor" href="#htc-newxname"></a>
</h4>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Compute the HTC for the newXname model</span></span>
<span><span class="co">#' @description Implements [HTC] for the newXname model with demography.</span></span>
<span><span class="co">#' @inheritParams ramp.xds::HTC</span></span>
<span><span class="co">#' @return a [numeric] vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">HTC.newXname</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="co">#HTC &lt;- </span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">HTC</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<div class="section level3">
<h3 id="xds_lines_x">16. xds_lines_X<a class="anchor" aria-label="anchor" href="#xds_lines_x"></a>
</h3>
<div class="section level4">
<h4 id="xds_lines_x_sis">xds_lines_X_SIS<a class="anchor" aria-label="anchor" href="#xds_lines_x_sis"></a>
</h4>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Add lines for the density of infected individuals for the SIS model</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param XH a list with the outputs of parse_deout_X_SIS</span></span>
<span><span class="co">#' @param nStrata the number of population strata</span></span>
<span><span class="co">#' @param clrs a vector of colors</span></span>
<span><span class="co">#' @param llty an integer (or integers) to set the `lty` for plotting</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">xds_lines_X_SIS</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">XH</span>, <span class="va">nStrata</span>, <span class="va">clrs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>,<span class="st">"darkred"</span><span class="op">)</span>, <span class="va">llty</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">XH</span>,<span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">nStrata</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">S</span>, col<span class="op">=</span><span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lty <span class="op">=</span> <span class="va">llty</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">I</span>, col<span class="op">=</span><span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lty <span class="op">=</span> <span class="va">llty</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">nStrata</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">)</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span> <span class="va">clrs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">clrs</span>, <span class="fl">2</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">llty</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="va">llty</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">llty</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span></span>
<span>      <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nStrata</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">S</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, col<span class="op">=</span><span class="va">clrs</span><span class="op">[</span><span class="fl">1</span>,<span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="va">llty</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">I</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, col<span class="op">=</span><span class="va">clrs</span><span class="op">[</span><span class="fl">2</span>,<span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="va">llty</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="xds_lines_x_newxname">xds_lines_X_newXname<a class="anchor" aria-label="anchor" href="#xds_lines_x_newxname"></a>
</h4>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Add lines for the density of infected individuals for the newXname model</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param XH a list with the outputs of parse_deout_X_newXname</span></span>
<span><span class="co">#' @param nStrata the number of population strata</span></span>
<span><span class="co">#' @param clrs a vector of colors</span></span>
<span><span class="co">#' @param llty an integer (or integers) to set the `lty` for plotting</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">xds_lines_X_newXname</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">XH</span>, <span class="va">nStrata</span>, <span class="va">clrs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>,<span class="st">"darkred"</span><span class="op">)</span>, <span class="va">llty</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">XH</span>,<span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">nStrata</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">S</span>, col<span class="op">=</span><span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lty <span class="op">=</span> <span class="va">llty</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">I</span>, col<span class="op">=</span><span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lty <span class="op">=</span> <span class="va">llty</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">nStrata</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">)</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span> <span class="va">clrs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">clrs</span>, <span class="fl">2</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">llty</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="va">llty</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">llty</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span></span>
<span>      <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nStrata</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">S</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, col<span class="op">=</span><span class="va">clrs</span><span class="op">[</span><span class="fl">1</span>,<span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="va">llty</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">I</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, col<span class="op">=</span><span class="va">clrs</span><span class="op">[</span><span class="fl">2</span>,<span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="va">llty</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="xds_plot_x">17. xds_plot_X<a class="anchor" aria-label="anchor" href="#xds_plot_x"></a>
</h3>
<p>We provide a basic plotting function. The function
<code>xds_lines_X_*</code> does not have an <code>S3</code> version.
Instead, it is called by the <code>S3</code> function
<code>xds_plot_X</code></p>
<div class="section level4">
<h4 id="generic-12">Generic<a class="anchor" aria-label="anchor" href="#generic-12"></a>
</h4>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Basic plotting for epidemiological models</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param pars a list that defines an `ramp.xds` model (*e.g.*,  generated by `xde_setup()`)</span></span>
<span><span class="co">#' @param i the host species index</span></span>
<span><span class="co">#' @param clrs a vector of colors</span></span>
<span><span class="co">#' @param llty an integer (or integers) to set the `lty` for plotting</span></span>
<span><span class="co">#' @param stable a logical: set to FALSE for `orbits` and TRUE for `stable_orbits`</span></span>
<span><span class="co">#' @param add_axes a logical: plot axes only if TRUE</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">xds_plot_X</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">=</span><span class="fl">1</span>, <span class="va">clrs</span><span class="op">=</span><span class="st">"black"</span>, <span class="va">llty</span><span class="op">=</span><span class="fl">1</span>, <span class="va">stable</span><span class="op">=</span><span class="cn">FALSE</span>, <span class="va">add_axes</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"xds_plot_X"</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="xds_plot_x-sis">xds_plot_X.SIS<a class="anchor" aria-label="anchor" href="#xds_plot_x-sis"></a>
</h4>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Plot the density of infected individuals for the newXname model</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @inheritParams ramp.xds::xds_plot_X</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">xds_plot_X.SIS</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">=</span><span class="fl">1</span>, <span class="va">clrs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>,<span class="st">"darkred"</span><span class="op">)</span>, <span class="va">llty</span><span class="op">=</span><span class="fl">1</span>, <span class="va">stable</span><span class="op">=</span><span class="cn">FALSE</span>, <span class="va">add_axes</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">vars</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">outputs</span>,<span class="kw">if</span><span class="op">(</span><span class="va">stable</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span><span class="va">stable_orbits</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">orbits</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">add_axes</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">XH</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="fl">0</span><span class="op">*</span><span class="va">time</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              ylab <span class="op">=</span> <span class="st">"# Infected"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="fu">xds_lines_X_SIS</span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">XH</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span>, <span class="va">clrs</span>, <span class="va">llty</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="xds_plot_x-newxname">xds_plot_X.newXname<a class="anchor" aria-label="anchor" href="#xds_plot_x-newxname"></a>
</h4>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Plot the density of infected individuals for the newXname model</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @inheritParams ramp.xds::xds_plot_X</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">xds_plot_X.newXname</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">i</span><span class="op">=</span><span class="fl">1</span>, <span class="va">clrs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>,<span class="st">"darkred"</span><span class="op">)</span>, <span class="va">llty</span><span class="op">=</span><span class="fl">1</span>, <span class="va">stable</span><span class="op">=</span><span class="cn">FALSE</span>, <span class="va">add_axes</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">vars</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">outputs</span>,<span class="kw">if</span><span class="op">(</span><span class="va">stable</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span><span class="va">stable_orbits</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">orbits</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">add_axes</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">XH</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="fl">0</span><span class="op">*</span><span class="va">time</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              ylab <span class="op">=</span> <span class="st">"# Infected"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">xds_lines_X_newXname</span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">XH</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">pars</span><span class="op">$</span><span class="va">Hpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nStrata</span>, <span class="va">clrs</span>, <span class="va">llty</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Reiner RC Jr, Perkins TA, Barker CM, Niu T, Chaves LF,
Ellis AM, et al. A systematic review of mathematical models of
mosquito-borne pathogen transmission: 1970-2010. J R Soc Interface.
2013;10: 20120921.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Wu SL, Henry JM, Citron DT, Mbabazi Ssebuliba D,
Nakakawa Nsumba J, Sánchez C. HM, et al. (2023) Spatial dynamics of
malaria transmission. PLoS Comput Biol 19(6): e1010684. <a href="https://doi.org/10.1371/journal.pcbi.1010684" class="external-link uri">https://doi.org/10.1371/journal.pcbi.1010684</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David L. Smith, Juliet Nsumba Nakakawa, Doreen Mbabazi Ssebuliba.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
